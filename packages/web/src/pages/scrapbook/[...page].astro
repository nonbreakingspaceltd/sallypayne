---
import LayoutBase from '../../layouts/Base.astro';
import LayoutList from '../../layouts/List.astro';
import CardMasonry from '../../components/CardMasonry/CardMasonry.vue';
import Pagination from '../../components/Pagination/Pagination.vue';
import { getPaginatedPosts } from '../../data/posts';
import { getSiteSettings } from '../../data/global';

export function getStaticPaths({ paginate }) {
  return getPaginatedPosts(paginate);
}

const siteSettings = await getSiteSettings();

const { page } = Astro.props;

let title = 'Scrapbook';
let metaTitle = `${title} | ${siteSettings.title}`;
if (page.currentPage > 1) {
  title = `${title} (Page ${page.currentPage})`;
  metaTitle = `${title} | ${siteSettings.title}`;
}

const meta = {
  title: metaTitle,
  description: `Sally Payne's Scrapbook is a place to share new work, scribbles, illustrations and ideas.`,
};

const posts = page.data.map(post => {
  const { title, path, excerpt, image, publishedDate } = post;
  // map to card props
  return {
    title,
    subtitle: publishedDate,
    href: path,
    excerpt,
    image,
    variant: 'scrapbook'
  }
});
---
<LayoutBase variant="post" meta={meta}>
  <LayoutList title={title} variant="scrapbook">
    <CardMasonry client:load items={posts} />
    <Pagination client:idle totalPage={page.lastPage} currentPage={page.currentPage} basePath="/scrapbook" />
  </LayoutList>
</LayoutBase>
